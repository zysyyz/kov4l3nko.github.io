<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>
		Twitter is watching you, anonymous - @kov4l3nko
	</title>
	<link rel="stylesheet" type="text/css" href="https://kov4l3nko.github.io/styles.css">
	
</head>
<body>
	<header>
		<div id="top">
			<div id="blog-title">
				<h1><a href="https://kov4l3nko.github.io/">@kov4l3nko</a></h1>
			</div>
			<div id="blog-menu">
				<a href="https://kov4l3nko.github.io/">Blog</a>
				
					<a href="https://kov4l3nko.github.io/about/">About</a>&nbsp;
				
					<a href="https://twitter.com/kov4l3nko">Twitter</a>&nbsp;
				
					<a href="https://github.com/kov4l3nko">GitHub</a>&nbsp;
				
					<a href="https://kov4l3nko.github.io/blog/index.xml">RSS</a>&nbsp;
				
			</div>
		</div>
		<img id="blog-title-image" src="title.jpg">
	</header>

	<content>
		<h1 class="post-title">Twitter is watching you, anonymous</h1>
		<div class="post-date">Nov 29, 2013</div>
		
		<p>Reversing the official Twitter client 5.13.1 for iOS, I found that it sends some very strange requests to a server. I used a custom GDB script to dump <a href="https://developer.apple.com/library/mac/documentation/Cocoa/Reference/Foundation/Classes/NSURLConnection_Class/Reference/Reference.html"><code>[NSURLConnection]</code></a> right before it invokes <a href="https://developer.apple.com/library/mac/documentation/Cocoa/Reference/Foundation/Classes/NSURLConnection_Class/Reference/Reference.html#jumpTo_15"><code>[start]</code></a>. It allowed me to see a HTTPS traffic between the Twitter client and server.</p>

<p>In addition to a usual traffic (registration, authorization, tweeting etc), I often saw POST requests to <code>https://api.twitter.com/1.1/jot/client_event</code>. The requests looked like</p>

<p><img src="sniff_twitter1.png" alt="" /></p>

<p>The Twitter client sent such requests after almost any action. I started the client? Ok, let&rsquo;s send a request! I tapped the &ldquo;Sign in&rdquo; button (did not sign in yet, just tapped the button)? Ok, let&rsquo;s send another request! I was just doing nothing for some time? One more request! I closed the Twitter client? More, more requests!.. I was intrigued by the requests. What do they mean? I played with the Twitter client and analyzed a couple of request dumps. Finally, I found out the common structure of the request:</p>

<pre><code>URL:    https://api.twitter.com/1.1/jot/client_event
Method: POST
Headers:
  X-Twitter-API-Version: 5
  Authorization: OAuth... blah-blah-blah, here is a usual OAuth authorization header signed with a secret key
  X-Twitter-Client: Twitter-iPhone
  X-Twitter-Client-Version: 5.13.1
  Geolocation: the user's location here (if you switch off Location Services, this header will gone)
  Accept-Language: en
  X-Twitter-Client-DeviceID: the ID of user's i-device
  X-Client-UUID: the UUID (it is a random number, it was generated by the Twitter client once on first start;
                 the UUID is the same for all requests)
  User-Agent: Twitter-iPhone/5.13.1 iOS/version here (Apple;iPhone3,1;;;;;1)
Body (it's URL-encoded):
  lang=en&amp;log=...a mistery JSON comes here...&amp;send_error_codes=1
</code></pre>

<p>Of course, the most interesting part of the request is the &ldquo;mystery JSON&rdquo; in the POST body :) It is an array of elements. Every element has the following structure:</p>

<pre><code>[
  ...
  {
   &quot;event_name&quot;: the name of the event
   &quot;ts&quot;: UNIX timestamp,
   &quot;format_version&quot;:2,
   &quot;_category_&quot;:&quot;client_event&quot;,
   &quot;client_version&quot;:&quot;Twitter-iPhone\5.13.1 iOS/version here
                    (Apple;iPhone3,1;;;;;1)&quot;
  }
  ...
]
</code></pre>

<p>For example, I tapped &ldquo;Sign in&rdquo; (I did not actually sign up, just tapped the button) and looked at the dump. The &ldquo;mystery JSON&rdquo; was:</p>

<pre><code>[
  {
   &quot;event_name&quot;:&quot;iphone:login:::impression&quot;,
   &quot;ts&quot;:1385678390003,
   &quot;format_version&quot;:2,
   &quot;_category_&quot;:&quot;client_event&quot;,
   &quot;client_version&quot;:&quot;Twitter-iPhone\5.13.1 iOS\6.1.3 (Apple;iPhone3,1;;;;;1)&quot;
  }
]
</code></pre>

<p>It looks like <code>event_name</code>, <code>ts</code>, <code>format_version</code>, <code>_category_</code> and <code>client_version</code> are mandatory fields. I saw them in all POST requests to <code>https://api.twitter.com/1.1/jot/client_event</code>. In addition, some elements of a &ldquo;mystery JSON&rdquo; may contain extra fields. For example, I tapped the &ldquo;Username&rdquo; input field in the sign in screen of the Twitter client, and saw</p>

<pre><code>[
  {
   &quot;_category_&quot;:&quot;client_event&quot;,
   &quot;event_name&quot;:&quot;iphone:ddg:digits_iphone_signup_1337::experiment&quot;,
   &quot;client_version&quot;:&quot;Twitter-iPhone\5.13.1 iOS\6.1.3 (Apple;iPhone3,1;;;;;1)&quot;,
   &quot;ts&quot;:1385678389354,
   &quot;experiment_key&quot;:&quot;digits_iphone_signup_1337&quot;,
   &quot;format_version&quot;:2,
   &quot;version&quot;:12,
   &quot;bucket&quot;:&quot;uncheck_follows&quot;
   }
]
</code></pre>

<p>Probably, the extra fields <code>experiment_key</code>, <code>version</code>, and <code>bucket</code> contained additional information about my action. What do the fields mean? I don&rsquo;t know yet.</p>

<p>Well, as far as I see it, the official Twitter client for iOS uses POST requests to <code>https://api.twitter.com/1.1/jot/client_event</code> to inform Twitter servers about almost any user&rsquo;s action. Probably, guys from Twitter will say &ldquo;don&rsquo;t worry, we are just collecting user experience&rdquo;, but in fact they know all about what and (taking into account the <code>Geolocation</code> header) when you are doing to the Twitter client, anonymous.</p>

<p>So it goes.</p>

		
		<h1>Wanna say something?</h1>
		<p>Commenting is not available in this blog, but you can <a href="https://kov4l3nko.github.io/about/">write me a letter or message</a>. Please, note that English is not my native language.
			I'm sorry for mistakes/missprints, if any.</p>
		

		
		
		
		
		
		
		
		
		
			
			
			
				
				
			
		
			
			
			
				
				
			
		
			
			
			
				
				
			
		
			
			
			
				
				
			
		
			
			
			
				
				
			
		
			
			
			
				
				
			
		
			
			
			
				
				
			
		
			
			
			
				
				
			
		
			
			
			
				
				
			
		
			
			
			
				
				
			
		
			
			
			
				
				
			
		
			
			
			
				
				
			
		
			
			
			
				
				
			
		
			
			
			
				
				
			
		
			
			
			
				
				
			
		
			
			
			
				
				
			
		
			
			
			
				
				
			
		
			
			
			
				
				
			
		
			
			
			
				
				
			
		
			
			
			
				
				
			
		
			
			
			
				
				
			
		
			
			
			
				
				
			
		
			
			
				
			
			
		
			
				
				
				
			
			
			
		
			
			
			
		
		
		
			Prev: <a href="https://kov4l3nko.github.io/blog/2012-08-30-breakpoints-in-smali-code/">Breakpoints in Smali code</a>
			<br>
		
		
			Next: <a href="https://kov4l3nko.github.io/blog/2013-12-01-how-to-prepare-iphone-4-with-ios-6-1-x-for-reverse-engineering-tasks/">How to prepare iPhone 4 with iOS 6.1.x for reverse engineering tasks</a>
			<br>
		
	</content>

	<footer>
		Copyright © Dima Kovalenko, 2012-2018
	</footer>
	
	<button onclick="topFunction()" id="scroll-btn" title="Go to top">▲</button>
	
	<script src="https://kov4l3nko.github.io/scripts.js"></script>
	
</body>
</html>